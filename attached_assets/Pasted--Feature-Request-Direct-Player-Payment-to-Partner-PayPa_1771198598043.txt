---

# ðŸ“Œ Feature Request: Direct Player Payment to Partner (PayPal / Crypto)

## ðŸŽ¯ Goal

Add support for **player payments received directly by a partner (Party A / B / or C)** via **PayPal or Crypto**, so that:

âœ… The payment is counted as **revenue**
âŒ It is **NOT treated as an expense**
âœ… It is automatically **offset against that partyâ€™s revenue share**
âœ… Other partiesâ€™ shares are **not reduced incorrectly**

This is needed when a player pays a partner directly instead of paying Party A.

---

## ðŸ§© Business Logic

### New Concept: `direct_player_payment`

A direct player payment has:

* amount
* currency (USD base)
* payment method (PayPal / Crypto)
* received_by (Party A / B / or C)
* proof (tx hash or PayPal ID)
* settlement_id

It behaves like:

> â€œAlready received revenue by X, to be deducted from Xâ€™s payoutâ€

---

## ðŸ§  Calculation Rules

### Step 1: Revenue

```
total_gross_revenue =
    paypal_revenue +
    direct_player_payments_sum
```

### Step 2: Expenses

```
net_revenue = total_gross_revenue - expenses
```

### Step 3: Split normally by contract %

```
party_a_share = net_revenue * percent_a
party_b_share = net_revenue * percent_b
party_c_share = net_revenue * percent_c
```

### Step 4: Offset direct payments

If Party B received $200 directly:

```
party_b_payout = party_b_share - 200
party_a_payout = party_a_share
party_c_payout = party_c_share
```

So:
âœ” Party B already has part of his share
âœ” System reduces what must be transferred to him
âœ” Others are unchanged

---

## ðŸ—„ï¸ Database (new table)

### direct_player_payments

| field          | type                            |
| -------------- | ------------------------------- |
| id             | bigint                          |
| settlement_id  | FK                              |
| amount         | decimal(10,2)                   |
| currency       | string                          |
| payment_method | enum(paypal, crypto)            |
| received_by    | enum(party_a, party_b, party_c) |
| reference      | string (tx hash / PayPal ID)    |
| notes          | text                            |
| created_at     | timestamp                       |

---

## ðŸ–¥ï¸ UI Requirements

### On â€œCreate Settlementâ€ screen:

Add section:

### âž• Direct Player Payments

Each row:

* Amount
* Payment Method (dropdown: PayPal / Crypto)
* Received By (dropdown: Party A / Party B / Party C)
* Reference (tx hash or PayPal transaction ID)
* Notes (optional)

Button:
âž• Add Direct Player Payment

---

## ðŸ“Š Settlement Summary Display

Example:

**Revenue**

* PayPal collected by Party A: $1,800
* Crypto payment received by Party B: $200
* **Total Gross Revenue: $2,000**

**Distribution**

* Party B share (62%): $1,240
* Less: already received via crypto: $200
* **Net payable to Party B: $1,040**

---

## ðŸ“¤ Export Requirements (Excel / CSV)

Include in export:

### Sheet: Settlement

Add:

* Direct Player Payments Total

### Sheet: DirectPayments

| Amount | Method | Received By | Reference |

And in notes:

> â€œIncludes player payment(s) received directly by Party X and offset against their revenue share.â€

---

## ðŸ§ª Validation Rules

* Amount > 0
* received_by required
* method required
* Cannot exceed that partyâ€™s share (warn if it does)
* Must still be counted as revenue

---

## ðŸ›¡ï¸ Accounting Rule (important)

**Direct player payments must NEVER:**
âŒ be treated as expenses
âŒ reduce total revenue
âŒ change percentage split
âŒ be ignored

They only:
âž¡ reduce what must be transferred to the receiving party

---

## ðŸ“ Contract Compatibility Text (logic matches):

> â€œPlayer payments received directly by a Party shall be included in gross revenue and offset against that Partyâ€™s revenue share.â€

---

## ðŸ”§ Dev Summary (short)

> Add support for direct player payments (PayPal/Crypto) received by Party A/B/C, count them as revenue, and automatically offset them from that partyâ€™s payout when calculating settlement splits. Include UI input, DB table, calculation logic, and Excel export.

